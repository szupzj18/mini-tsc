# mini-tsc

`mini-tsc` 是一个刻意保持精简的 TypeScript 编译器原型，用来解释真实 TypeScript 工具链中的关键环节。它目前提供一个可运行的词法分析器，以及后续流水线（语法分析、AST、发射器、类型检查）的脚手架，方便贡献者循序渐进地扩展。

## 为什么要做这个项目
- 提供一个可读性强的编译器代码库，在不引入生产级复杂度的情况下展示关键阶段。
- 作为在迁移到更大项目之前进行词法/语法实验的练习场。
- 让新人了解在类编译器项目里测试、构建和自动化工具如何协同。

## 功能状态
| 模块 | 状态 | 说明 |
| --- | --- | --- |
| 词法分析 | ✅ 已实现 | 支持 `let`、标识符、数字/字符串字面量、`+ - * /` 运算符，以及 `; ,` 等分隔符。 |
| 语法分析 | 🚧 进行中 | 已保留函数签名，目前返回 `null`，需要补齐 AST 构建逻辑。 |
| AST / 发射器 | 🚧 进行中 | 已定义 `SyntaxKind`、节点接口，`emit` 暂时返回占位字符串。 |
| 类型检查 | ❌ 未开始 | 尚未提供语义分析。 |
| 工具链 | ✅ 可用 | TypeScript、Jest（通过 `ts-jest`）以及基于 Gulp 的编译流水线。 |

## 仓库结构
- `src/mini-tsc.ts`：token 定义、`SyntaxKind`、词法分析实现，以及语法/发射器占位。
- `src/mini-tsc.test.ts`：使用 Jest 的单测，验证词法器并固定解析器的 API。
- `src/core.ts`：未来运行时控制器的接口草稿（目前未使用）。
- `gulpfile.js`：通过 Gulp 串联 TypeScript 编译与监听。
- `tsconfig.json`：面向 `es2016`、输出到 `dist/` 的严格编译配置。

## 快速开始
1. **安装依赖**
   ```bash
   npm install
   ```
2. **编译 TypeScript**
   ```bash
   npm run build          # 使用 tsc 输出到 dist/
   # 或者
   npx gulp build         # 走 gulp-typescript 流水线
   ```
3. **运行测试**
   ```bash
   npm test
   ```
4. **监听模式（可选）**
   ```bash
   npx gulp watch         # 监听 src/ 下的变更自动编译
   npm run test:watch     # 监听并重跑 Jest
   ```

## 架构概览
- **词法阶段**：遍历源码，生成带行列信息的 `Token`，处理空白/换行，识别 `let` 等关键字并以标识符兜底。
- **AST 契约**：`SyntaxKind`、`Node`、`SourceFile`、`Statement` 描述了树的形态，为解析器和发射器打通数据格式。
- **解析与发射**：`parse` 保留接口供未来 AST 构建使用；`emit` 暂以字符串占位，待树结构准备好后即可挂接任意代码生成实验。

## 建议的后续工作
- 实现支持 `let x = 1;` 等变量声明与表达式语句的解析流程。
- 扩展词法器，添加 `{}`、`()` 等符号以及布尔、模板字面量。
- 编写一个使用虚拟 AST 的发射器测试，以及早锁定输出格式。
- 实现最小化的类型检查流程，例如检测重复声明或字面量与注解是否匹配。
- 更多待办见 [`TODO.md`](./TODO.md)。

## 贡献指南
1. Fork 并克隆仓库。
2. 创建特性分支（`git checkout -b feature/your-idea`）。
3. 保持 `npm test` 通过，并在 README（含本中文版本）中记录行为变化。
4. 提交 Pull Request，说明动机、实现方式以及如何验证。

这个项目就是为了保持“小而快”，欢迎随意尝试、简化和迭代 ✨。
